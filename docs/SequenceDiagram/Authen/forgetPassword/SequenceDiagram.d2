label.style.font-color: black

classes: {
  text-black: {
    style: {
      font-color: black
    }
  }

  return arrow: {
    style: {
      stroke-dash: 3
      stroke: black
      font-color: black
    }
  }

  frame: {
    style: {
      fill: '#EAEDF0'
      stroke-width: 1
    }
  }

  label right: {
    style.font-color: black
  }
}

shape: sequence_diagram

User: {
  shape: image
  width: 50
  height: 60
  icon: https://upload.wikimedia.org/wikipedia/commons/5/5b/Robustness_Diagram_Actor.svg
}

application: "chat application"
apiGateway: "apiGateway"
AuthController: "authController"
AuthRepository: "authRepository"
AuthDAO: "authDAO"
Supabase: "supabase"
DB: "DB" {
  shape: cylinder
}
EmailService: "emailService"

# Forgot password sequence
User -> application.get: "1. Navigate to forgot password page"
User -> application.post: "2. Enter email and submit request"
application -> apiGateway.post: "3. Forward forgot password request"
apiGateway -> AuthController.post: "4. Handle forgot password request"
AuthController -> AuthRepository.post: "5. Forward to repository"
AuthRepository -> AuthDAO.post: "6. Forward to DAO"
AuthDAO -> Supabase.post: "7. Check if email exists"
Supabase -> DB.query: "8. Check email in database"
DB -> Supabase.response: "9. Return email status"

alt: "alt" {
  class: frame
  Email exists: "[Email exists]" {
    Supabase -> Supabase.generate: "10b. Generate reset token"
    Supabase -> Supabase.response: "11b. Return reset token"
    Supabase -> EmailService.send: "12b. Send reset link to email"
    EmailService -> Supabase.response: "13b. Email sent confirmation"
    Supabase -> AuthDAO.response: "14b. Forward reset token"
    AuthDAO -> AuthRepository.response: "15b. Forward reset token"
    AuthRepository -> AuthController.response: "16b. Return reset token"
    AuthController -> apiGateway.response: "17b. Send reset token to frontend"
    apiGateway -> application.response: "18b. Return reset token"
    application -> User: "19b. Display reset token and instructions"
  }
  Email not found: "[Email not found]" {
    Supabase -> AuthDAO.response: "10a. Email not found"
    AuthDAO -> AuthRepository.response: "11a. Forward error"
    AuthRepository -> AuthController.response: "12a. Return error"
    AuthController -> apiGateway.response: "13a. Send error to frontend"
    apiGateway -> application.response: "14a. Return error"
    application -> User: "15a. Display error message"
  }
}