label.style.font-color: black

classes: {
  text-black: {
    style: {
      font-color: black
    }
  }

  return arrow: {
    style: {
      stroke-dash: 3
    }
  }

  frame: {
    style: {
      fill: '#EAEDF0'
      stroke-width: 1
    }
  }

  label right: {
    style.font-color: black
  }
}

shape: sequence_diagram

User: {
  shape: image
  width: 50
  height: 60
  icon: https://upload.wikimedia.org/wikipedia/commons/5/5b/Robustness_Diagram_Actor.svg
}

application: chat application
apiGateway: apiGateway
AuthController: authController
AuthRepository: authRepository
AuthDAO: authDAO

DB: "DB" {
  shape: cylinder
}

User: {
  shape: image
  width: 50
  height: 60
  icon: https://upload.wikimedia.org/wikipedia/commons/5/5b/Robustness_Diagram_Actor.svg
}

application: "chat application"
apiGateway: "apiGateway"
AuthController: "authController"
AuthRepository: "authRepository"
AuthDAO: "authDAO"
Supabase: "supabase"
DB: "DB" {
  shape: cylinder
}

# Recover password sequence
User -> application.post: "1. Navigate to reset password page"
User -> application.post: "2. Enter reset token and new password, then submit"
application -> apiGateway.post: "3. Forward reset password request"
apiGateway -> AuthController.post: "4. Handle reset password request"
AuthController -> AuthRepository.post: "5. Forward to repository"
AuthRepository -> AuthDAO.post: "6. Forward to DAO"
AuthDAO -> AuthDAO.check: "7. Validate new password"
AuthDAO -> Supabase: "8. Validate reset token and hash new password"
Supabase -> Supabase.check: "9. Validate reset token"
Supabase -> Supabase.hash: "10. Hash the new password"
Supabase -> DB.update: "11. Update user password"

alt: "alt" {
  class: frame
  Reset successful: "[Reset successful]" {
    Supabase -> AuthDAO.post: "13b. Return success status" {class: return arrow}
    AuthDAO -> AuthRepository.post: "14b. Forward success status" {class: return arrow}
    AuthRepository -> AuthController.post: "15b. Return success status" {class: return arrow}
    AuthController -> apiGateway.post: "16b. Send success status to frontend" {class: return arrow}
    apiGateway -> application.post: "17b. Return success status" {class: return arrow}
    application -> User: "18b. Display password reset success message" {class: return arrow}
  }
  Reset failed: "[Reset failed]" {
    Supabase -> AuthDAO.post: "13a. Return error status" {class: return arrow}
    AuthDAO -> AuthRepository.post: "14a. Forward error status" {class: return arrow}
    AuthRepository -> AuthController.post: "15a. Return error status" {class: return arrow}
    AuthController -> apiGateway.post: "16a. Send error status to frontend" {class: return arrow}
    apiGateway -> application.post: "17a. Return error status" {class: return arrow}
    application -> User: "18a. Display error message"
  }
}